#!/bin/bash
set -e

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

# TODO: maybe move to a lib?
bundle() {
	local bundle="$1"; shift
	source "$SCRIPTDIR/make/$bundle" "$@"
}

bundle .detect-daemon-osarch
if [ $DOCKER_ENGINE_GOOS != "windows" ]; then
	bundle .ensure-emptyfs
	bundle .ensure-frozen-images
	bundle .ensure-httpserver
	bundle .ensure-syscall-test
	bundle .ensure-nnp-test
else
	# Note this is Windows to Windows CI, not Windows to Linux CI
	bundle .ensure-frozen-images-windows
fi
